<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∞—Ö–º–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä "Blindfold"</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- –£–±–∏—Ä–∞–µ–º –æ—à–∏–±–∫—É 404 –¥–ª—è favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ôüÔ∏è</text></svg>">
</head>

<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="chess-piece-loader">‚ôüÔ∏è</div>
            <h2 class="loading-title">–®–∞—Ö–º–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä "Blindfold"</h2>
            <p class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            <div class="loading-bar">
                <div class="loading-bar-progress" id="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
    <div class="top-stats">
        <div class="stat-box-top">
            <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
            <div class="stat-value-top" id="level">1</div>
        </div>
        <div class="stat-box-top">
            <div class="stat-label">–•–æ–¥</div>
            <div class="stat-value-top" id="move">0/20</div>
        </div>
        <div class="stat-box-top">
            <div class="stat-label">–û—à–∏–±–∫–∏</div>
            <div class="stat-value-top" id="errors">0/3</div>
        </div>
        <div class="stat-box-top">
            <div class="stat-label">–í—Ä–µ–º—è</div>
            <div class="stat-value-top" id="timer">00:00</div>
        </div>
        <button class="btn-rules" id="rules-btn">–ü—Ä–∞–≤–∏–ª–∞</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="main-container">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <!-- –£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å -->
            <div class="user-management">
                <h3>–£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å</h3>
                <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω) -->
                <div id="login-prompt">
                    <button id="open-login-btn" class="btn-login">üîê –í–æ–π—Ç–∏</button>
                    <p style="text-align: center; margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                        –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∫–æ—Ä–¥—ã
                    </p>
                </div>
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω) -->
                <div id="user-info" style="display: none;">
                    <p style="margin-bottom: 10px;">
                        üë§ –ò–≥—Ä–æ–∫: <strong id="current-user"></strong>
                    </p>
                    <button id="logout-btn" class="btn btn-secondary" style="width: 100%;">
                        –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ -->
            <div class="leaderboard">
                <h3>üèÜ –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</h3>
                <div id="leaderboard-list"></div>
                <div class="legend">
                    <div><strong>–ó–Ω–∞—á–∫–∏:</strong></div>
                    <div>‚≠ê - –ò–¥–µ–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞ (0 –æ—à–∏–±–æ–∫, –±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫)</div>
                    <div>üòé - –†–µ–∂–∏–º "–í—Å–ª–µ–ø—É—é"</div>
                    <div>üéØ - 100% —Ç–æ—á–Ω–æ—Å—Ç—å</div>
                </div>
            </div>
        </div>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å –¥–æ—Å–∫–æ–π -->
        <div class="game-area">
            <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–æ–≤ –ù–ê–î –¥–æ—Å–∫–æ–π -->
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="blindfold">–í—Å–ª–µ–ø—É—é</button>
                <button class="mode-btn" data-mode="beginner">–î–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö</button>
            </div>

            <div class="board-wrapper">
                <div id="chessboard"></div>
            </div>

            <!-- –¢–µ–∫—É—â–∏–π —Ö–æ–¥ –ü–û–î –¥–æ—Å–∫–æ–π -->
            <div class="current-player-bottom" id="current-player">
                –¢–µ–∫—É—â–∏–π —Ö–æ–¥: <span id="player-side">–±–µ–ª—ã–µ</span>
            </div>

            <!-- –ù–∏–∂–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ -->
            <div class="bottom-buttons">
                <button class="btn-bottom btn-start" id="start-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                <button class="btn-bottom btn-hint" id="hint-btn" disabled>–ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
                <button class="btn-bottom btn-reset" id="reset-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ -->
    <div class="modal" id="rules-modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <h2>–ü—Ä–∞–≤–∏–ª–∞ –¥–≤–∏–∂–µ–Ω–∏—è —Ñ–∏–≥—É—Ä</h2>
            <div class="rules">
                <div class="rule">‚ôô –ü–µ—à–∫–∞: –≤–ø–µ—Ä–µ–¥ –Ω–∞ 1 –∫–ª–µ—Ç–∫—É, –±—å–µ—Ç –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏</div>
                <div class="rule">‚ôò –ö–æ–Ω—å: –±—É–∫–≤–æ–π "–ì" (2+1 –∫–ª–µ—Ç–∫–∏)</div>
                <div class="rule">‚ôó –°–ª–æ–Ω: –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏</div>
                <div class="rule">‚ôñ –õ–∞–¥—å—è: –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏</div>
                <div class="rule">‚ôï –§–µ—Ä–∑—å: –≤ –ª—é–±–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏</div>
                <div class="rule">‚ôî –ö–æ—Ä–æ–ª—å: –Ω–∞ 1 –∫–ª–µ—Ç–∫—É –≤ –ª—é–±–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏</div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div class="auth-modal" id="auth-modal" style="display: none;">
        <div class="auth-content">
            <span class="close-auth" id="close-auth">&times;</span>

            <h2 class="auth-title">–®–∞—Ö–º–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä "Blindfold"</h2>
            <p class="auth-subtitle">–†–∞–∑–≤–∏–≤–∞–π—Ç–µ –Ω–∞–≤—ã–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏!</p>

            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div id="login-form" class="auth-form">
                <div class="input-group">
                    <input type="text" id="login-username" placeholder="–õ–æ–≥–∏–Ω" class="auth-input">
                </div>
                <div class="input-group">
                    <input type="password" id="login-password" placeholder="–ø–∞—Ä–æ–ª—å" class="auth-input">
                    <span class="toggle-password" id="toggle-login-password">üëÅÔ∏è</span>
                </div>
                <button id="login-submit-btn" class="auth-btn">–í–æ–π—Ç–∏</button>
                <p class="auth-switch">
                    –ï—â—ë –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è? <a href="#" id="show-register">–ü—Ä–æ–π–¥–∏—Ç–µ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</a>
                </p>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div id="register-form" class="auth-form" style="display: none;">
                <div class="input-group">
                    <input type="text" id="register-username" placeholder="–õ–æ–≥–∏–Ω" class="auth-input">
                </div>
                <div class="input-group">
                    <input type="password" id="register-password" placeholder="–ø–∞—Ä–æ–ª—å" class="auth-input">
                    <span class="toggle-password" id="toggle-register-password">üëÅÔ∏è</span>
                </div>
                <button id="register-submit-btn" class="auth-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <p class="auth-switch">
                    –£–∂–µ –µ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—å? <a href="#" id="show-login">–í–æ–π—Ç–∏</a>
                </p>
            </div>
        </div>
    </div>

    <div class="message" id="message"></div>

    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º gameState –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º -->
    <script>
        // –°–æ–∑–¥–∞–µ–º gameState –≥–ª–æ–±–∞–ª—å–Ω–æ –î–û –∑–∞–≥—Ä—É–∑–∫–∏ Firebase
        window.gameState = {
            mode: 'blindfold',
            level: 1,
            currentMove: 0,
            maxMoves: 20,
            errors: 0,
            maxErrors: 3,
            time: 0,
            timerInterval: null,
            isPlaying: false,
            currentPosition: [],
            activePiece: null,
            activePieceStartPos: null,
            targetPiece: null,
            pieces: [],
            hintUsed: false,
            currentUser: null,
            userId: null,
            currentPlayer: 'w',
            debugMode: false
        };
        console.log('üéÆ gameState –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');

        // –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        window.loadingProgress = {
            current: 0,
            total: 4, // gameState, Firebase, Auth, Leaderboard module
            modulesLoaded: false,
            pageRendered: false,
            leaderboardDataLoaded: false,
            
            update: function() {
                this.current++;
                const percent = Math.min((this.current / this.total) * 70, 70); // –ú–∞–∫—Å–∏–º—É–º 70% –¥–ª—è –º–æ–¥—É–ª–µ–π
                const progressBar = document.getElementById('loading-progress');
                if (progressBar) {
                    progressBar.style.width = percent + '%';
                }
                console.log(`üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π: ${this.current}/${this.total} (${Math.round(percent)}%)`);
                
                if (this.current >= this.total) {
                    this.modulesLoaded = true;
                    this.checkComplete();
                }
            },
            
            setLeaderboardDataLoaded: function() {
                this.leaderboardDataLoaded = true;
                const progressBar = document.getElementById('loading-progress');
                if (progressBar) {
                    progressBar.style.width = '85%';
                }
                console.log('üìä –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω—ã: 85%');
                this.checkComplete();
            },
            
            setPageRendered: function() {
                this.pageRendered = true;
                const progressBar = document.getElementById('loading-progress');
                if (progressBar) {
                    progressBar.style.width = '100%';
                }
                console.log('üé® –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–∞: 100%');
                this.checkComplete();
            },
            
            checkComplete: function() {
                if (this.modulesLoaded && this.leaderboardDataLoaded && this.pageRendered) {
                    this.complete();
                }
            },
            
            complete: function() {
                console.log('‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ! –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É...');
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loading-screen');
                    if (loadingScreen) {
                        loadingScreen.classList.add('loaded');
                    }
                }, 300);
            }
        };

        // –û–∂–∏–¥–∞–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            console.log('üìÑ –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —à—Ä–∏—Ñ—Ç—ã, —Å—Ç–∏–ª–∏)');
            
            // –ñ–¥–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    window.loadingProgress.setPageRendered();
                });
            });
        });

        // gameState –∑–∞–≥—Ä—É–∂–µ–Ω
        window.loadingProgress.update();
    </script>

    <script src="js/chess-rules.js"></script>
    <script src="js/script.js"></script>

    <!-- Firebase SDK -->
    <!-- prettier-ignore -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAtjyskpNX37pXLWuq5SkU7YhLwqFHLC_o",
            authDomain: "shahmaton-dd992.firebaseapp.com",
            projectId: "shahmaton-dd992",
            storageBucket: "shahmaton-dd992.firebasestorage.app",
            messagingSenderId: "921991403571",
            appId: "1:921991403571:web:63865e723854919b31eb46",
            measurementId: "G-FPL3SR81Z7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
        window.firebaseApp = app;
        window.firebaseAnalytics = analytics;
        window.firebaseAuth = auth;
        window.firebaseDB = db;

        console.log("Firebase —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω! ‚úÖ");
        
        // Firebase –∑–∞–≥—Ä—É–∂–µ–Ω
        if (window.loadingProgress) {
            window.loadingProgress.update();
        }
    </script>

    <!-- Firebase Auth Script -->
    <script src="js/firebase-auth.js" type="module"></script>
    
    <!-- Firebase Leaderboard Script -->
    <script src="js/firebase-leaderboard.js" type="module"></script>
</body>

</html>